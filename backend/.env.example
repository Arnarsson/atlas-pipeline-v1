# ============================================================================
# Atlas Data Pipeline Platform - Environment Configuration
# ============================================================================
# Version: 1.0
# Description: Environment variables for Atlas data pipeline platform
# Documentation: See docs/SETUP.md for detailed configuration guide
# ============================================================================

# ----------------------------------------------------------------------------
# DOMAIN & ENVIRONMENT
# ----------------------------------------------------------------------------
DOMAIN=localhost
ENVIRONMENT=local  # local, staging, production
FRONTEND_HOST=http://localhost:5173

# ----------------------------------------------------------------------------
# PROJECT CONFIGURATION
# ----------------------------------------------------------------------------
PROJECT_NAME="Atlas Data Pipeline Platform"
STACK_NAME=atlas-pipeline
API_VERSION=v1
API_PREFIX=/api/v1

# ----------------------------------------------------------------------------
# BACKEND CONFIGURATION
# ----------------------------------------------------------------------------
BACKEND_CORS_ORIGINS="http://localhost,http://localhost:5173,http://localhost:8000,https://localhost,https://localhost:5173"
SECRET_KEY=changethis_to_a_secure_random_string
FIRST_SUPERUSER=admin@atlas.local
FIRST_SUPERUSER_PASSWORD=changethis

# API Rate Limiting
API_RATE_LIMIT=100  # requests per minute
API_BURST_LIMIT=200

# ----------------------------------------------------------------------------
# DATABASE - PostgreSQL
# ----------------------------------------------------------------------------
POSTGRES_SERVER=localhost
POSTGRES_PORT=5432
POSTGRES_DB=atlas_pipeline
POSTGRES_USER=atlas_user
POSTGRES_PASSWORD=changethis

# Connection Pool Settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Database for different layers (Medallion Architecture)
# Bronze Layer
BRONZE_DB=atlas_bronze
# Silver Layer
SILVER_DB=atlas_silver
# Gold Layer
GOLD_DB=atlas_gold

# ----------------------------------------------------------------------------
# REDIS - Cache & Message Broker
# ----------------------------------------------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=changethis
REDIS_SSL=false

# Cache Configuration
CACHE_TTL=3600  # seconds
CACHE_ENABLED=true

# ----------------------------------------------------------------------------
# CELERY - Task Queue
# ----------------------------------------------------------------------------
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_TASK_ALWAYS_EAGER=false  # Set true for synchronous testing
CELERY_TASK_EAGER_PROPAGATES=true
CELERY_WORKER_CONCURRENCY=4
CELERY_TASK_TIME_LIMIT=3600  # 1 hour max per task
CELERY_TASK_SOFT_TIME_LIMIT=3300  # 55 minutes soft limit

# ----------------------------------------------------------------------------
# OBJECT STORAGE - MinIO / S3
# ----------------------------------------------------------------------------
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=changethis
S3_BUCKET_BRONZE=atlas-bronze
S3_BUCKET_SILVER=atlas-silver
S3_BUCKET_GOLD=atlas-gold
S3_BUCKET_AI_READY=atlas-ai-ready
S3_REGION=us-east-1
S3_USE_SSL=false

# ----------------------------------------------------------------------------
# PREFECT - Workflow Orchestration
# ----------------------------------------------------------------------------
PREFECT_API_URL=http://localhost:4200/api
PREFECT_API_KEY=
PREFECT_AGENT_ENABLED=true
PREFECT_WORK_POOL=atlas-pool
PREFECT_LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# PRESIDIO - PII Detection & Anonymization
# ----------------------------------------------------------------------------
PRESIDIO_ANALYZER_URL=http://localhost:5001
PRESIDIO_ANONYMIZER_URL=http://localhost:5002
PRESIDIO_LANGUAGES=en,da  # English, Danish
PRESIDIO_SCORE_THRESHOLD=0.35
PRESIDIO_ENABLED=true

# Custom PII Recognizers
PRESIDIO_CUSTOM_RECOGNIZERS_ENABLED=true
PRESIDIO_CUSTOM_PATTERNS_PATH=/app/config/presidio_patterns.yaml

# ----------------------------------------------------------------------------
# SODA CORE - Data Quality
# ----------------------------------------------------------------------------
SODA_ENABLED=true
SODA_CONFIG_PATH=/app/config/soda_config.yaml
SODA_CHECKS_PATH=/app/config/soda_checks

# Quality Thresholds
QUALITY_COMPLETENESS_THRESHOLD=0.95
QUALITY_VALIDITY_THRESHOLD=0.90
QUALITY_CONSISTENCY_THRESHOLD=0.85
QUALITY_ACCURACY_THRESHOLD=0.90
QUALITY_TIMELINESS_THRESHOLD=0.95
QUALITY_UNIQUENESS_THRESHOLD=0.99

# ----------------------------------------------------------------------------
# OPENLINEAGE - Data Lineage
# ----------------------------------------------------------------------------
OPENLINEAGE_ENABLED=true
OPENLINEAGE_URL=http://localhost:5000/api/v1/lineage
OPENLINEAGE_API_KEY=
OPENLINEAGE_NAMESPACE=atlas_pipeline
OPENLINEAGE_TRANSPORT=http

# Marquez (OpenLineage Backend)
MARQUEZ_URL=http://localhost:5000
MARQUEZ_DB_HOST=localhost
MARQUEZ_DB_PORT=5432
MARQUEZ_DB_NAME=marquez
MARQUEZ_DB_USER=marquez
MARQUEZ_DB_PASSWORD=changethis

# ----------------------------------------------------------------------------
# PIPELINE CONFIGURATION
# ----------------------------------------------------------------------------
# Processing
PIPELINE_BATCH_SIZE=1000
PIPELINE_MAX_RETRIES=3
PIPELINE_RETRY_DELAY=60  # seconds
PIPELINE_TIMEOUT=3600  # 1 hour

# Dead Letter Queue
DLQ_ENABLED=true
DLQ_TABLE=pipeline_dead_letter_queue
DLQ_MAX_AGE_DAYS=30

# Data Retention
DATA_RETENTION_BRONZE_DAYS=90
DATA_RETENTION_SILVER_DAYS=365
DATA_RETENTION_GOLD_DAYS=730
DATA_RETENTION_AI_READY_DAYS=365

# ----------------------------------------------------------------------------
# MONITORING & OBSERVABILITY
# ----------------------------------------------------------------------------
# Logging
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
LOG_FILE_PATH=/var/log/atlas
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5

# Metrics
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Sentry (Error Tracking)
SENTRY_DSN=
SENTRY_ENABLED=false
SENTRY_ENVIRONMENT=local
SENTRY_TRACES_SAMPLE_RATE=0.1

# ----------------------------------------------------------------------------
# EMAIL CONFIGURATION
# ----------------------------------------------------------------------------
SMTP_HOST=
SMTP_USER=
SMTP_PASSWORD=
EMAILS_FROM_EMAIL=noreply@atlas.local
SMTP_TLS=true
SMTP_SSL=false
SMTP_PORT=587
EMAILS_ENABLED=false

# Email Notifications
NOTIFY_ON_PIPELINE_FAILURE=true
NOTIFY_ON_QUALITY_ISSUES=true
NOTIFY_ON_PII_DETECTION=true
NOTIFICATION_RECIPIENTS=admin@atlas.local

# ----------------------------------------------------------------------------
# SECURITY
# ----------------------------------------------------------------------------
# JWT Authentication
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=7
ALGORITHM=HS256

# API Keys
API_KEYS_ENABLED=true
API_KEY_HEADER_NAME=X-API-Key

# Encryption
ENCRYPTION_ENABLED=true
ENCRYPTION_KEY=changethis_to_a_32_byte_key
FERNET_KEY=changethis_to_a_fernet_compatible_key

# ----------------------------------------------------------------------------
# DOCKER CONFIGURATION
# ----------------------------------------------------------------------------
DOCKER_IMAGE_BACKEND=atlas-backend
DOCKER_IMAGE_FRONTEND=atlas-frontend
DOCKER_IMAGE_WORKER=atlas-worker

# ----------------------------------------------------------------------------
# FEATURE FLAGS
# ----------------------------------------------------------------------------
FEATURE_API_ENABLED=true
FEATURE_DASHBOARD_ENABLED=true
FEATURE_BOT_ENABLED=false
FEATURE_ML_INFERENCE_ENABLED=false
FEATURE_AUDIT_LOG_ENABLED=true
FEATURE_AUTO_SCALING_ENABLED=false

# ----------------------------------------------------------------------------
# DEVELOPMENT & TESTING
# ----------------------------------------------------------------------------
# Only for local development
DEBUG=false
RELOAD=true  # Auto-reload on code changes
TESTING=false

# Test Database
TEST_POSTGRES_DB=atlas_pipeline_test
TEST_POSTGRES_USER=atlas_test_user
TEST_POSTGRES_PASSWORD=testpass

# Sample Data
LOAD_SAMPLE_DATA=false
SAMPLE_DATA_PATH=/app/data/samples
